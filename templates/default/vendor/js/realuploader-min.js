/**
 * Real Uploader 
 * http://www.realuploader.com/ajaxuploader
 * Build date Fri May 27 2016 19:46:43 GMT+0100 (IST)
 * Copyright 2010-2015, Xscripts, http://www.albanx.com
 */

/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

(function(e,t){var n=t();typeof define=="function"&&define.amd?define(t):e.realuploader=e.RealUploader=n,e.jQuery&&(e.jQuery.fn.realuploader=function(t){return this.each(function(){e.jQuery.data(this,"RealUploader")||e.jQuery.data(this,"RealUploader",new n(this,t))})})})(this,function(){var e,t,n;return function(r){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(e){if(v(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!v(a,e)&&!v(c,e))throw new Error("No "+e);return a[e]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(e,t,n,i){var s,l,h,p,d,m=[],y=typeof n,E;i=i||e;if(y==="undefined"||y==="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(d=0;d<t.length;d+=1){p=o(t[d],i),l=p.f;if(l==="require")m[d]=u.require(e);else if(l==="exports")m[d]=u.exports(e),E=!0;else if(l==="module")s=m[d]=u.module(e);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=n?n.apply(a[e],m):undefined;if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!E)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){if(typeof e=="string")return u[e]?u[e](t):w(o(e,t).f);if(!e.splice){l=e,l.deps&&s(l.deps,l.callback);if(!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s},s.config=function(e){return s(e)},e._defined=a,n=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),n("Constants",[],function(){var e={AX_ERROR:-1,AX_IDLE:0,AX_DONE:1,AX_UPLOADING:2,AX_CHECK:3,AX_READY:4,AX_NO_FILES:5,events:{finish:"upload_finish",finishFile:"upload_finish_file",start:"start_upload",startFile:"start_upload_file",progress:"progress",progressFile:"progress_file",beforeUpload:"before_upload",beforeUploadFile:"before_upload_file",md5Done:"md5_calculated",exifDone:"exif_decoded",beforePreview:"before_preview",preview:"preview_done"},ENV:"PROD",IMAGE_SCALE_ON:!0,MD5_ON:!0,EXIF_ON:!0,VERSION:""};return e}),n("i18n",[],function(){var e={en_EN:{"Add files":"Add files","Start upload":"Start upload","Remove all":"Remove all",Close:"Close","Select Files":"Select Files",Preview:"Preview","Remove file":"Remove file",Bytes:"Bytes",KB:"KB",MB:"MB",GB:"GB","Upload aborted":"Upload aborted","Upload all files":"Upload files","Select Files or Drag&Drop Files":"Select Files or Drag&Drop Files","File uploaded 100%":"File uploaded 100%","Max files number reached":"Max files number reached","Extension not allowed":"Extension not allowed","File size now allowed":"File size now allowed"},it_IT:{"Add files":"Aggiungi file","Start upload":"Carica tutto","Remove all":"Rimuvi tutti",Close:"Chiudi","Select Files":"Seleziona",Preview:"Anteprima","Remove file":"Rimuovi file",Bytes:"Bytes",KB:"KB",MB:"MB",GB:"GB","Upload aborted":"Interroto","Upload all files":"Carica tutto","Select Files or Drag&Drop Files":"Seleziona o Trascina qui i file","File uploaded 100%":"File caricato 100%","Max files number reached":"Max files number reached","Extension not allowed":"Estensione file non permessa","File size now allowed":"Dimensione file non permessa"},sq_AL:{"Add files":"Shto file","Start upload":"Fillo karikimin","Remove all":"Hiqi te gjithë",Close:"Mbyll","Select Files":"Zgjith filet",Preview:"Miniaturë","Remove file":"Hiqe file-in",Bytes:"Bytes",KB:"KB",MB:"MB",GB:"GB","Upload aborted":"Karikimi u ndërpre","Upload all files":"Kariko të gjithë","Select Files or Drag&Drop Files":"Zgjith ose Zvarrit dokumentat këtu","File uploaded 100%":"File u karikua 100%","Max files number reached":"Maksimumi i fileve u arrit","Extension not allowed":"Prapashtesa nuk lejohet","File size now allowed":"Madhësia e filit nuk lejohet"},nl_NL:{"Add files":"Bestanden toevoegen","Start upload":"Start uploaden","Remove all":"Verwijder alles",Close:"Sluiten","Select Files":"Selecteer bestanden",Preview:"Voorbeeld","Remove file":"Verwijder bestand",Bytes:"Bytes",KB:"KB",MB:"MB",GB:"GB","Upload aborted":"Upload afgebroken","Upload all files":"Upload alle bestanden","Select Files or Drag&Drop Files":"Selecteer bestanden of  Drag&Drop bestanden","File uploaded 100%":"Bestand geüpload 100%"},de_DE:{"Add files":"Dateien hinzufügen","Start upload":"Hochladen","Remove all":"Alle entfernen",Close:"Schliessen","Select Files":"Dateien wählen",Preview:"Vorschau","Remove file":"Datei entfernen",Bytes:"Bytes",KB:"KB",MB:"MB",GB:"GB","Upload aborted":"Upload abgebrochen","Upload all files":"Alle hochgeladen","Select Files or Drag&Drop Files":"Wählen Sie Dateien oder fügen Sie sie mit Drag & Drop hinzu.","File uploaded 100%":"Upload 100%"},fr_FR:{"Add files":"Ajouter","Start upload":"Envoyer","Remove all":"Tout supprimer",Close:"Fermer","Select Files":"Parcourir",Preview:"Visualiser","Remove file":"Supprimer fichier",Bytes:"Bytes",KB:"Ko",MB:"Mo",GB:"Go","Upload aborted":"Envoi annulé","Upload all files":"Tout envoyer","Select Files or Drag&Drop Files":"Parcourir ou Glisser/Déposer","File uploaded 100%":"Fichier envoyé 100%"},es_ES:{"Add files":"Agregar","Start upload":"Iniciar","Remove all":"Quitar todo",Close:"Cerrar","Select Files":"Seleccionar",Preview:"Visualizar","Remove file":"Eliminar Archivo",Bytes:"Bytes",KB:"KB",MB:"MB",GB:"GB","Upload aborted":"Subida cancelada","Upload all files":"Subir todos","Select Files or Drag&Drop Files":"Seleccionar o Arrastrar&Soltar Archivos","File uploaded 100%":"Archivo subido al 100%","Max files number reached":"Numero max de Archivos alcanzado","Extension not allowed":"Extension prohibida","File size now allowed":"Archivo demasiado grande"}},t=function(){var n=arguments[0];if(!t.prototype._singletonInstance)t.prototype._singletonInstance=this,this.lang=n;else if(n){var r=t.prototype._singletonInstance;return r.lang&&e[r.lang]!==undefined&&e[r.lang][n]!==undefined?e[r.lang][n]:n}};return t}),n("Utils",["i18n","Constants"],function(e,t){var n={runInBackground:function(e){var t=URL.createObjectURL(new Blob(["(",function(e){function t(t){e(t)}self.addEventListener("message",function(e){t(e.data)},!1)}.toString(),")(",e.toString(),")"],{type:"application/javascript"})),n=new Worker(t);return n},sliceFile:function(e,t,n){try{e.slice();var r=window.File.prototype.slice||window.File.prototype.webkitSlice||window.File.prototype.mozSlice;return e.slice(t,n)}catch(i){return e.slice(t,n-t)}return null},doEl:function(e,t,n,r){var i=document.createElement(e);this.addCls(i,t);if(n)for(var s in n)i.setAttribute(s,n[s]);return this.setStyle(i,r),i},setStyle:function(e,t){if(t)for(var n in t)e.style[n]=t[n];return e},addCls:function(e,t){return t&&"classList"in e?e.classList.add(t):t&&e.className+" "+t,e},byCls:function(e,t,n){t||(t=document);var r=t.getElementsByClassName(e);return t.getElementsByClassName(e)},getEl:function(){if(arguments.length==1)return document.querySelector(arguments[0]);try{if(arguments[0]&&arguments[0].querySelector)return arguments[0].querySelector(arguments[1])}catch(e){return null}return null},getEls:function(){return arguments.length==1?document.querySelectorAll(arguments[0]):arguments[0].querySelectorAll(arguments[1])},formatSize:function(t){var n=[e("b"),e("KB"),e("MB"),e("GB")],r=0;while(t>=1024&&r<n.length-1)t/=1024,r++;var i=Math.round(t),s=Math.pow(10,2),o=Math.round(t*s%s);return i+"."+o+" "+n[r]},extend:function(e,t,n){var r="[object Array]",i="[object Object]",s,o,u=function(e){if(e===undefined)return 0;if(typeof e!="object")return!1;var t={}.toString.call(e);if(t===r)return 1;if(t===i)return 2};for(var a in t)t.hasOwnProperty(a)&&(s=u(e[a]),o=u(t[a]),!n&&o&&s&&s===o?e[a]=this.extend(e[a],t[a],!0):o!==0&&(e[a]=t[a]));return e},lightBoxPreview:function(e,t,n,r){var i=this.doEl("div","ax-lightbox-target",{}),s=this.doEl("div","ax-image-box",{}),o=this.doEl("img","ax-image-prev",{src:e.src}),u=this.doEl("div","ax-info-box",{}),a=this.doEl("div","ax-name-box",{}),f=this.doEl("div","ax-size-box",{}),l=this.doEl("a","ax-lightbox-close",{});i.appendChild(s),i.appendChild(l),i.appendChild(u),s.appendChild(o),u.appendChild(a),u.appendChild(f),document.body.appendChild(i),a.innerHTML=t,f.innerHTML=n,r&&(o.className+=" "+r),setTimeout(function(){i.classList.add("show")},100);var c=function(e){i&&document.body.removeChild(i),i=null,s=null,u=null,a=null,f=null,l=null,o=null,c=null,window.removeEventListener("keyup",h)},h=function(e){e.keyCode===27&&c()};return l.addEventListener("click",c),window.addEventListener("keyup",h),i},isInt:function(e){var t;return isNaN(e)?!1:(t=parseFloat(e),(t|0)===t)},parseSize:function(e){if(!n.isInt(e)){var t=e.slice(-1);if(isNaN(t)){e=parseInt(e.replace(t,""));switch(t){case"P":e*=1024;case"T":e*=1024;case"G":e*=1024;case"M":e*=1024;case"K":e*=1024}}}return e},ajaxPost:function(e,t,n){var r=new XMLHttpRequest;typeof n=="function"&&(this.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var e=this.responseText;try{e=JSON.parse(this.responseText)}catch(t){return!1}n(e),r=null}}),r.open("POST",e),r.send(t)},log:function(){if(t.ENV==="DEV"){var e=Array.prototype.slice.call(arguments,0),n=new Date,r=(n.getHours()<10?"0":"")+n.getHours()+":"+(n.getMinutes()<10?"0":"")+n.getMinutes()+":"+(n.getSeconds()<10?"0":"")+n.getSeconds();e.unshift(r),console.log.apply(console,e)}}};return n}),n("SimpleRunner",[],function(){var e=function(e){this._yes=[],this._no=[],this._always=[],this.scope=e};return e.prototype={yes:function(e){return this._yes.push(e),this},no:function(e){return this._no.push(e),this},always:function(e){return this._always.push(e),this},run:function(e){if(this["_"+e]){var t=this["_"+e].concat(this._always);for(var n=0;n<t.length;n++){var r=t[n];r.fn?r.fn.call(r.scope||this.scope):typeof r=="function"&&r.call(this.scope)}}return this}},e}),n("FileMd5",["Utils"],function(e){function n(e){function i(e,t,n,r,i,s,o){return e=e+(t&n|~t&r)+(i>>>0)+o,(e<<s|e>>>32-s)+t}function s(e,t,n,r,i,s,o){return e=e+(t&r|n&~r)+(i>>>0)+o,(e<<s|e>>>32-s)+t}function o(e,t,n,r,i,s,o){return e=e+(t^n^r)+(i>>>0)+o,(e<<s|e>>>32-s)+t}function u(e,t,n,r,i,s,o){return e=e+(n^(t|~r))+(i>>>0)+o,(e<<s|e>>>32-s)+t}function a(e,t){for(var n=t[0],r=t[1],a=t[2],f=t[3],l=0;l<e.length;l+=16)var c=n,h=r,p=a,d=f,n=i(n,r,a,f,e[l+0],7,-680876936),f=i(f,n,r,a,e[l+1],12,-389564586),a=i(a,f,n,r,e[l+2],17,606105819),r=i(r,a,f,n,e[l+3],22,-1044525330),n=i(n,r,a,f,e[l+4],7,-176418897),f=i(f,n,r,a,e[l+5],12,1200080426),a=i(a,f,n,r,e[l+6],17,-1473231341),r=i(r,a,f,n,e[l+7],22,-45705983),n=i(n,r,a,f,e[l+8],7,1770035416),f=i(f,n,r,a,e[l+9],12,-1958414417),a=i(a,f,n,r,e[l+10],17,-42063),r=i(r,a,f,n,e[l+11],22,-1990404162),n=i(n,r,a,f,e[l+12],7,1804603682),f=i(f,n,r,a,e[l+13],12,-40341101),a=i(a,f,n,r,e[l+14],17,-1502002290),r=i(r,a,f,n,e[l+15],22,1236535329),n=s(n,r,a,f,e[l+1],5,-165796510),f=s(f,n,r,a,e[l+6],9,-1069501632),a=s(a,f,n,r,e[l+11],14,643717713),r=s(r,a,f,n,e[l+0],20,-373897302),n=s(n,r,a,f,e[l+5],5,-701558691),f=s(f,n,r,a,e[l+10],9,38016083),a=s(a,f,n,r,e[l+15],14,-660478335),r=s(r,a,f,n,e[l+4],20,-405537848),n=s(n,r,a,f,e[l+9],5,568446438),f=s(f,n,r,a,e[l+14],9,-1019803690),a=s(a,f,n,r,e[l+3],14,-187363961),r=s(r,a,f,n,e[l+8],20,1163531501),n=s(n,r,a,f,e[l+13],5,-1444681467),f=s(f,n,r,a,e[l+2],9,-51403784),a=s(a,f,n,r,e[l+7],14,1735328473),r=s(r,a,f,n,e[l+12],20,-1926607734),n=o(n,r,a,f,e[l+5],4,-378558),f=o(f,n,r,a,e[l+8],11,-2022574463),a=o(a,f,n,r,e[l+11],16,1839030562),r=o(r,a,f,n,e[l+14],23,-35309556),n=o(n,r,a,f,e[l+1],4,-1530992060),f=o(f,n,r,a,e[l+4],11,1272893353),a=o(a,f,n,r,e[l+7],16,-155497632),r=o(r,a,f,n,e[l+10],23,-1094730640),n=o(n,r,a,f,e[l+13],4,681279174),f=o(f,n,r,a,e[l+0],11,-358537222),a=o(a,f,n,r,e[l+3],16,-722521979),r=o(r,a,f,n,e[l+6],23,76029189),n=o(n,r,a,f,e[l+9],4,-640364487),f=o(f,n,r,a,e[l+12],11,-421815835),a=o(a,f,n,r,e[l+15],16,530742520),r=o(r,a,f,n,e[l+2],23,-995338651),n=u(n,r,a,f,e[l+0],6,-198630844),f=u(f,n,r,a,e[l+7],10,1126891415),a=u(a,f,n,r,e[l+14],15,-1416354905),r=u(r,a,f,n,e[l+5],21,-57434055),n=u(n,r,a,f,e[l+12],6,1700485571),f=u(f,n,r,a,e[l+3],10,-1894986606),a=u(a,f,n,r,e[l+10],15,-1051523),r=u(r,a,f,n,e[l+1],21,-2054922799),n=u(n,r,a,f,e[l+8],6,1873313359),f=u(f,n,r,a,e[l+15],10,-30611744),a=u(a,f,n,r,e[l+6],15,-1560198380),r=u(r,a,f,n,e[l+13],21,1309151649),n=u(n,r,a,f,e[l+4],6,-145523070),f=u(f,n,r,a,e[l+11],10,-1120210379),a=u(a,f,n,r,e[l+2],15,718787259),r=u(r,a,f,n,e[l+9],21,-343485551),n=n+c>>>0,r=r+h>>>0,a=a+p>>>0,f=f+d>>>0;return[n,r,a,f]}function f(e,t,n,r){e=new Uint8Array(e),e=Crypto.util.endian(Crypto.util.bytesToWords(e)),n===r&&(t=8*(n-t),r*=8,e[t>>>5]|=128<<r%32,e[(t+64>>>9<<4)+14]=r),self.md5hash=a(e,self.md5hash)}function l(e){var t=e.file,n=new FileReaderSync;t.slice=t.webkitSlice||t.mozSlice||t.slice;for(var r=t.size,i=0,s=1048576>r?r:1048576;i<r;){var o=n.readAsArrayBuffer(t.slice(i,s));f(o,i,s,r),i=s,s+=1048576,s>r&&(s=r),Math.ceil(100*s/r)===self.percent&&(postMessage({status:"progress",progress:self.percent}),self.percent++)}var u=Crypto.util.bytesToHex(Crypto.util.wordsToBytes(Crypto.util.endian(self.md5hash)));t=null,n=null,postMessage({status:"end",result:u})}self.percent=1;var t=self.Crypto={},n=t.util={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return n.rotl(e,8)&16711935|n.rotl(e,24)&4278255360;for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(Math.random()*256));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=(e[n]&255)<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<e.length*32;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((e[n]&15).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){if(typeof btoa=="function")return btoa(r.bytesToString(e));for(var t=[],n=0;n<e.length;n+=3)for(var i=e[n]<<16|e[n+1]<<8|e[n+2],s=0;s<4;s++)n*8+s*6<=e.length*8?t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>>6*(3-s)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){if(typeof atob=="function")return r.stringToBytes(atob(e));for(var e=e.replace(/[^A-Z0-9+\/]/ig,""),t=[],n=0,i=0;n<e.length;i=++n%4)i!=0&&t.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<i*2|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(n))>>>6-i*2);return t}},t=t.charenc={};t.UTF8={stringToBytes:function(e){return r.stringToBytes(e)},bytesToString:function(e){return decodeURIComponent(r.bytesToString(e))}};var r=t.Binary={stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n)&255);return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}};self.md5hash=[1732584193,-271733879,-1732584194,271733878],l(e)}var t=function(t){var r=this,i=function(e){var t=e.data;t.status=="progress"?r._runStack(r._progress,[t.progress]):t.status=="end"&&(r._runStack(r._done,[t.result])._runStack(r._always,[e]),r.md5Worker.terminate())},s=function(e){r._runStack(r._error,[e])._runStack(r._always,[e]),r.md5Worker.terminate()};this._done=[],this._error=[],this._always=[],this._progress=[];try{this.md5Worker=e.runInBackground(n),this.md5Worker.onmessage=i,this.md5Worker.onerror=s,this.file=t}catch(o){r._runStack(r._error,[o])._runStack(r._always,[o])}};return t.prototype={done:function(e,t){return this._addCallback(e,t,"done")},progress:function(e,t){return this._addCallback(e,t,"progress")},error:function(e,t){return this._addCallback(e,t,"error")},always:function(e,t){return this._addCallback(e,t,"always")},_addCallback:function(e,t,n){return typeof e=="function"&&this["_"+n].push({callback:e,ctx:t}),this},_runStack:function(e,t){var n=0,r=e.length;for(n=0;n<r;n++)e[n].callback.apply(e[n].ctx,t);return this},start:function(){return this._startTime=new Date,this.md5Worker.postMessage({file:this.file}),this},stop:function(){this.md5Worker.terminate()}},t}),n("ExifReader",["Utils"],function(e){var t=function(t,n){var r=this;r.options={maxBufferSize:262144};if(n!==null&&typeof n=="object")for(var i in n)n.hasOwnProperty(i)&&(r.options[i]=n[i]);return r._done=[],r._error=[],r._always=[],r._progress=[],r.file=e.sliceFile(t,0,r.options.maxBufferSize),this};return t.prototype={start:function(){function n(t){var n=new DataView(t.target.result);if(n.getUint8(0)==255&&n.getUint8(1)==216&&n.getUint8(2)==255){e._runStack(e._progress,["jpegData"]);var r=e.readExifJpeg(n);e._runStack(e._progress,["readIPTCJpeg"]);var i=e.readIPTCJpeg(n);e._runStack(e._done,[r,i])}e._runStack(e._always,[t])}function r(t){e._runStack(e._error,[t])}function i(t){e._runStack(e._progress,[t,"File reading"])}var e=this;e._runStack(e._progress,["File reading"]);var t=new FileReader;t.onload=n,t.onerror=r,t.onprogress=i,t.readAsArrayBuffer(this.file)},stop:function(){},done:function(e,t){return this._addCallback(e,t,"done")},progress:function(e,t){return this._addCallback(e,t,"progress")},error:function(e,t){return this._addCallback(e,t,"error")},always:function(e,t){return this._addCallback(e,t,"always")},_addCallback:function(e,t,n){return typeof e=="function"&&this["_"+n].push({callback:e,ctx:t}),this},_runStack:function(e,t){var n=0,r=e.length;for(n=0;n<r;n++)e[n].callback.apply(e[n].ctx,t);return this},tags:{exif:{36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},tiff:{256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},GPS:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},StringValues:{ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}}},readExifJpeg:function(e){var t=2;while(t<e.byteLength){if(e.getUint8(t+1)==225)return this.readExif(e,t+4);t+=2+e.getUint16(t+2)}return!1},readIPTCJpeg:function(e){var t=2,n=function(e,t){return e.getUint8(t)===56&&e.getUint8(t+1)===66&&e.getUint8(t+2)===73&&e.getUint8(t+3)===77&&e.getUint8(t+4)===4&&e.getUint8(t+5)===4};while(t<e.byteLength){if(n(e,t)){var r=e.getUint8(t+7);r%2!==0&&(r+=1),r===0&&(r=4);var i=t+8+r,s=e.getUint16(t+6+r);return this.readIPTCData(e,i,s)}t++}},readExif:function(e,t){if(this.getStringFromDB(e,t,4)!="Exif")return!1;var n,r,i,s=t+6;if(e.getUint16(s)==18761)n=!1;else{if(e.getUint16(s)!=19789)return!1;n=!0}if(e.getUint16(s+2,!n)!=42)return!1;var o=e.getUint32(s+4,!n);if(o<8)return!1;var u=this.readTags(e,s,s+o,this.tags.tiff,n);if(u.ExifIFDPointer){var a=this.readTags(e,s,s+u.ExifIFDPointer,this.tags.exif,n);for(r in a)if(a.hasOwnProperty(r)){switch(r){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":a[r]=this.tags.StringValues[r][a[r]];break;case"ExifVersion":case"FlashpixVersion":a[r]=String.fromCharCode(a[r][0],a[r][1],a[r][2],a[r][3]);break;case"ComponentsConfiguration":a[r]=this.tags.StringValues.Components[a[r][0]]+this.tags.StringValues.Components[a[r][1]]+this.tags.StringValues.Components[a[r][2]]+this.tags.StringValues.Components[a[r][3]]}u[r]=a[r]}}if(u.GPSInfoIFDPointer){i=this.readTags(e,s,s+u.GPSInfoIFDPointer,this.tags.GPS,n);for(r in i){switch(r){case"GPSVersionID":i[r]=i[r][0]+"."+i[r][1]+"."+i[r][2]+"."+i[r][3]}u[r]=i[r]}}return u},readIPTCData:function(e,t,n){var r={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"},i={},s,o,u,a,f,l=t;while(l<t+n)e.getUint8(l)===28&&e.getUint8(l+1)===2&&(a=e.getUint8(l+2),a in r&&(u=e.getInt16(l+3),f=u+5,o=r[a],s=this.getStringFromDB(e,l+5,u),i.hasOwnProperty(o)?i[o]instanceof Array?i[o].push(s):i[o]=[i[o],s]:i[o]=s)),l++;return i},readTags:function(e,t,n,r,i){var s=e.getUint16(n,!i),o={},u,a,f;for(f=0;f<s;f++)u=n+f*12+2,a=r[e.getUint16(u,!i)],a||console.log("Unknown tag: "+e.getUint16(u,!i)),o[a]=this.readTagValue(e,u,t,n,i);return o},readTagValue:function(e,t,n,r,i){var s=e.getUint16(t+2,!i),o=e.getUint32(t+4,!i),u=e.getUint32(t+8,!i)+n,a,f,l,c,h,p;switch(s){case 1:case 7:if(o==1)return e.getUint8(t+8,!i);a=o>4?u:t+8,f=[];for(c=0;c<o;c++)f[c]=e.getUint8(a+c);return f;case 2:return a=o>4?u:t+8,this.getStringFromDB(e,a,o-1);case 3:if(o==1)return e.getUint16(t+8,!i);a=o>2?u:t+8,f=[];for(c=0;c<o;c++)f[c]=e.getUint16(a+2*c,!i);return f;case 4:if(o==1)return e.getUint32(t+8,!i);f=[];for(c=0;c<o;c++)f[c]=e.getUint32(u+4*c,!i);return f;case 5:if(o==1)return h=e.getUint32(u,!i),p=e.getUint32(u+4,!i),l=new Number(h/p),l.numerator=h,l.denominator=p,l;f=[];for(c=0;c<o;c++)h=e.getUint32(u+8*c,!i),p=e.getUint32(u+4+8*c,!i),f[c]=new Number(h/p),f[c].numerator=h,f[c].denominator=p;return f;case 9:if(o==1)return e.getInt32(t+8,!i);f=[];for(c=0;c<o;c++)f[c]=e.getInt32(u+4*c,!i);return f;case 10:if(o==1)return e.getInt32(u,!i)/e.getInt32(u+4,!i);f=[];for(c=0;c<o;c++)f[c]=e.getInt32(u+8*c,!i)/e.getInt32(u+4+8*c,!i);return f}},getStringFromDB:function(e,t,n){var r="";for(var i=t;i<t+n;i++)r+=String.fromCharCode(e.getUint8(i));return r},pretty:function(e){var t,n="";for(t in e)e.hasOwnProperty(t)&&(typeof e[t]=="object"?e[t]instanceof Number?n+=t+" : "+e[t]+" ["+e[t].numerator+"/"+e[t].denominator+"]\r\n":n+=t+" : ["+e[t].length+" values]\r\n":n+=t+" : "+e[t]+"\r\n");return n}},t}),n("ExifRestorer",[],function(){var e=function(){this.onComplete=null};return e.prototype={restore:function(e,t){var n=this;n.readExifData(e,function(e){if(e){var r=new FileReader;r.onload=function(r){var i=new DataView(r.target.result),s=n.findExifIndex(i),o=i.buffer.slice(0,s),u=i.buffer.slice(s);typeof n.onComplete=="function"&&n.onComplete(new Blob([o,e,u],{type:t.type}))},r.readAsArrayBuffer(t)}else n.onComplete(t)})},readExifData:function(e,t){var n=this,r=new FileReader;return r.onload=function(e){var r=new DataView(e.target.result),i=n.findExifData(r);t(i)},r.readAsArrayBuffer(e),r},findExifIndex:function(e){var t=3;while(t<e.byteLength){if(e.getUint8(t)==255)return t;t++}return 0},findExifData:function(e){var t=0;while(t<e.byteLength){if(e.getUint8(t)==255&&e.getUint8(t+1)==218)break;if(e.getUint8(t)==255&&e.getUint8(t+1)==216)t+=2;else{var n=t+e.getUint8(t+2)*256+e.getUint8(t+3)+2;if(e.getUint8(t)==255&&e.getUint8(t+1)==225)return e.buffer.slice(t,n);t=n}}return!1}},e}),n("ImageScale",["Utils","ExifRestorer"],function(e,t){function r(e){function t(e){return e<0?0:e>255?255:e}function n(e,t,n){var r=t*n,i=new Uint16Array(r),s,o;for(s=0,o=0;s<r;s++)i[s]=e[o+2]*7471+e[o+1]*38470+e[o]*19595>>>8,o=o+4|0;return i}function r(e,r,i,s,o,u){var a,l,c,h=0,p,d,v=Math.floor(s*256/50),m=n(e,r,i),g=f(m,r,i,1),y=u<<8,b=0;for(l=0;l<i;l++)for(a=0;a<r;a++)h=m[b]-g[b],Math.abs(h)>y&&(p=65536+(h*v>>8),d=b*4,c=e[d],e[d++]=t(c*p>>16),c=e[d],e[d++]=t(c*p>>16),c=e[d],e[d]=t(c*p>>16)),b++}function a(e,t,n,r,u){var a,f,l,c,h,p,d,v=0,m=i,g=s;p=0,d=0;if(t>=g&&n>=g&&t+g<r&&n+g<u){for(f=0;f<3;f++)for(a=0;a<3;a++)l=t+a-g,c=n+f-g,d+=e[l+c*r]*m[v++];return(d-d%o)/o}for(f=0;f<3;f++)for(a=0;a<3;a++)l=t+a-g,c=n+f-g,l>=0&&l<r&&c>=0&&c<u&&(h=m[v],p+=h,d+=e[l+c*r]*h),v++;return(d-d%p)/p|0}function f(e,t,n){var r,i,s=new Uint16Array(e.length);for(r=0;r<t;r++)for(i=0;i<n;i++)s[i*t+r]=a(e,r,i,t,n);return s}function h(e){return Math.floor(e*c)}function d(e,t,n){isNaN(e)&&(e=3);var r=p[e].filter,i=n/t,s=1/i,o=Math.min(1,i),u=p[e].win/o,a,f,l,c,d,v,m,g,y,b,w,E,S,x,T,N,C,k=Math.floor((u+1)*2),L=new Int16Array((k+2)*n),A=0;for(a=0;a<n;a++){f=(a+.5)*s,l=Math.max(0,Math.floor(f-u)),c=Math.min(t-1,Math.ceil(f+u)),d=c-l+1,v=new Float32Array(d),m=new Int16Array(d),g=0;for(b=l,w=0;b<=c;b++,w++)E=r((b+.5-f)*o),g+=E,v[w]=E;y=0;for(w=0;w<v.length;w++)S=h(v[w]/g),y+=S,m[w]=S;m[n>>1]+=h(1)-y,x=0;while(x<m.length&&m[x]===0)x++;if(x<m.length){T=m.length-1;while(T>0&&m[T]===0)T--;N=l+x,C=T-x+1,L[A++]=N,L[A++]=C,L.set(m.subarray(x,T+1),A),A+=C}else L[A++]=0,L[A++]=0}return L}function v(e,n,r,i,s,o){var u,a,f,c,h,p,d,v,m,g,y,b=0,w=0;for(m=0;m<i;m++){h=0;for(g=0;g<s;g++){p=o[h++],d=o[h++],v=b+p*4|0,u=a=f=c=0;for(;d>0;d--)y=o[h++],c=c+y*e[v+3]|0,f=f+y*e[v+2]|0,a=a+y*e[v+1]|0,u=u+y*e[v]|0,v=v+4|0;n[w+3]=t(c>>l),n[w+2]=t(f>>l),n[w+1]=t(a>>l),n[w]=t(u>>l),w=w+i*4|0}w=(m+1)*4|0,b=(m+1)*r*4|0}}function m(e,n,r,i,s,o){var u,a,f,c,h,p,d,v,m,g,y,b=0,w=0;for(m=0;m<i;m++){h=0;for(g=0;g<s;g++){p=o[h++],d=o[h++],v=b+p*4|0,u=a=f=c=0;for(;d>0;d--)y=o[h++],c=c+y*e[v+3]|0,f=f+y*e[v+2]|0,a=a+y*e[v+1]|0,u=u+y*e[v]|0,v=v+4|0;n[w+3]=t(c>>l),n[w+2]=t(f>>l),n[w+1]=t(a>>l),n[w]=t(u>>l),w=w+i*4|0}w=(m+1)*4|0,b=(m+1)*r*4|0}}function g(e,t,n){var r=3,i=t*n*4|0;while(r<i)e[r]=255,r=r+4|0}function y(e){postMessage({status:"progress",progress:0});var t=e.srcData,n=e.width,i=e.height,s=Math.round(e.newWidth),o=Math.round(e.newHeight),u=new Uint8Array(s*o*4),a=e.scaleMethod?e.scaleMethod:3,f=e.alpha||!1,l=e.unsharpAmount===undefined?0:e.unsharpAmount|0,c=e.unsharpThreshold===undefined?0:e.unsharpThreshold|0;if(n<1||i<1||s<1||o<1)return!1;postMessage({status:"progress",progress:10});var h=d(a,n,s);postMessage({status:"progress",progress:20});var p=d(a,i,o);postMessage({status:"progress",progress:30});var y=new Uint8Array(s*i*4);return v(t,y,n,i,s,h),postMessage({status:"progress",progress:50}),m(y,u,i,s,o,p),postMessage({status:"progress",progress:70}),f||(g(u,s,o),postMessage({status:"progress",progress:80})),l&&(r(u,s,o,l,1,c),postMessage({status:"progress",progress:90})),postMessage({status:"progress",progress:100}),u}var i=new Uint8Array([1,2,1,2,4,2,1,2,1]),s=Math.floor(Math.floor(Math.sqrt(i.length))/2),o=0;for(var u=0;u<i.length;u++)o+=i[u];var l=14,c=1<<l,p=[{win:.5,filter:function(e){return e>=-0.5&&e<.5?1:0}},{win:1,filter:function(e){if(e<=-1||e>=1)return 0;if(e>-1.1920929e-7&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*(.54+.46*Math.cos(t/1))}},{win:2,filter:function(e){if(e<=-2||e>=2)return 0;if(e>-1.1920929e-7&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*Math.sin(t/2)/(t/2)}},{win:3,filter:function(e){if(e<=-3||e>=3)return 0;if(e>-1.1920929e-7&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*Math.sin(t/3)/(t/3)}}],b=y(e);postMessage({status:"end",imageData:b,progress:0,newWidth:e.newWidth,newHeight:e.newHeight})}HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){var r=atob(this.toDataURL(t,n).split(",")[1]),i=r.length,s=new Uint8Array(i);for(var o=0;o<i;o++)s[o]=r.charCodeAt(o);e(new Blob([s],{type:t||"image/jpeg"}))}});var n=function(e,t){var n=this;n.options={maxWidth:0,maxHeight:0,allowOverResize:!1,outputFormat:!1,outputQuality:1,scaleMethod:3,keepExif:!1,keepAspectRatio:!0,unsharpAmount:0,unsharpThreshold:0,alpha:!0};if(t!==null&&typeof t=="object")for(var r in t)t.hasOwnProperty(r)&&(n.options[r]=t[r]);n.file=e,n.fileExt=e.name.split(".").pop().toLowerCase(),n._done=[],n._error=[],n._always=[],n._progress=[]};return n.prototype={done:function(e,t){return this._addCallback(e,t,"done")},progress:function(e,t){return this._addCallback(e,t,"progress")},error:function(e,t){return this._addCallback(e,t,"error")},always:function(e,t){return this._addCallback(e,t,"always")},_addCallback:function(e,t,n){return typeof e=="function"&&this["_"+n].push({callback:e,ctx:t}),this},_runStack:function(e,t){var n=0,r=e.length;for(n=0;n<r;n++)e[n].callback.apply(e[n].ctx,t);return this},start:function(){return this._validateOptions()?this._readImage():this._onError("Settings not valid",null)},stop:function(){this.worker&&this.worker.terminate()},_validateOptions:function(){var e=this.options;return(!isNaN(e.maxWidth)||!isNaN(e.maxHeight))&&(e.maxWidth>0||e.maxHeight>0)&&(this.file.toString()==="[object File]"||this.file.toString()==="[object Blob]")},_readImage:function(){var e=window.URL||window.webkitURL;if(e&&e.createObjectURL)this._onDoneRead({target:{result:e.createObjectURL(this.file)},callback:function(){e.revokeObjectURL(this.file)}});else{var t=new FileReader;t.onprogress=this._onProgressRead.bind(this),t.onerror=this._onErrorRead.bind(this),t.onload=this._onDoneRead.bind(this),t.readAsDataURL(this.file)}return this},_onProgressRead:function(e){var t=Math.round(e.loaded*100/e.total);this._runStack(this._progress,[t,"Reading file",e])},_onDoneRead:function(e){var t=new Image,n=this;t.onload=function(){n._scale(this),e.callback&&e.callback()},t.onerror=n._onErrorImageLoad.bind(n),t.src=e.target.result},_createCanvas:function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.setAttribute("width",e),n.setAttribute("height",t),n},_scale:function(t){var n=this,r=t.width,i=t.height,s=n.options.maxWidth,o=n.options.maxHeight,u=n.options.overResize,a=0,f=0;if(n.options.keepAspectRatio){var l=s/r,c=o/i,h=0;l>0&&c>0?h=Math.min(l,c):l>0?h=l:c>0&&(h=c),a=Math.round(r*h),f=Math.round(i*h)}else a=s,f=o;if(!u&&(a>t.width||f>t.height))e.log("This image will not be resized"),this._onError("Resize image is bigger than original. AllowResize option disabled.",null);else{e.log("New image sizes: ",a,f);var p=n._createCanvas(r,i),d=p.getContext("2d");d.drawImage(t,0,0,r,i);var v=d.getImageData(0,0,r,i).data,m={width:r,height:i,newWidth:a,newHeight:f,ratio:h,quality:3,srcData:v,scaleMethod:n.options.scaleMethod,unsharpThreshold:n.options.unsharpThreshold,unsharpAmount:n.options.unsharpAmount,alpha:n.options.alpha};this.worker=this._startScale(t,m)}return t=null,this},_startScale:function(t,n){var i=e.runInBackground(r);return i?(i.onmessage=this._onMessageScale.bind(this),i.onerror=this._onErrorScale.bind(this),i.postMessage(n),t=null,i):null},_onMessageScale:function(e){var n=e.data,r=this;if(n.status=="progress")r._runStack(r._progress,[n.progress,"Scale progress"]);else if(n.status=="end"){r._runStack(r._progress,[n.progress,"Saving..."]);var i=r.options.outputFormat,s=r.options.outputQuality,o=r.fileExt=="png"?"image/png":"image/jpeg";i&&(o=i=="png"?"image/png":"image/jpeg");var u=r._createCanvas(n.newWidth,n.newHeight),a=u.getContext("2d"),f=a.getImageData(0,0,n.newWidth,n.newHeight),l=f.data;if(l.set)l.set(n.imageData);else{var c,h;for(c=0,h=n.imageData.length;c<h;c++)l[c]=n.imageData[c]}u.getContext("2d").putImageData(f,0,0),u.toBlob(function(n){if(r.options.keepExif){var i=new t;i.onComplete=function(t){r._runStack(r._done,[t,e])._runStack(r._always,[t,e])},i.restore(r.file,n)}else r._runStack(r._done,[n,e])._runStack(r._always,[n,e]);r._dstCanvas=null},o,s)}},_onErrorRead:function(e){return this._onError("File read error",e)},_onErrorImageLoad:function(e){return this._onError("Image scale error",e)},_onErrorScale:function(e){return this._onError("Scale error",e)},_onError:function(e,t){return this._runStack(this._error,[e,t])._runStack(this._always,[t])}},n}),n("FileObject",["Constants","Utils","SimpleRunner","i18n","FileMd5","ExifReader","ImageScale"],function(e,t,n,r,i,s,o){"use strict";var u=function(t,n,r){var i=this;i.file=t,i.name=t.name,i.size=t.size,i.ext=t.extension,i.fileId=n,i.tempFileName=null,i.xhr=null,i.info=null,i.extraInfo=null,i.status=e.AX_IDLE,i.AU=r,i.config=r.config,i.exifData=null,i.md5="",i.disabled=!1,i.ready=!1,i.requestDuration=0,i.currentFun=null,i.dom={},i.imgCls="",i.checkSum={},i.currentByte=0,i.loading_bytes=0,i.temp_bytes=0,i._preUploadFun=[],i.speedInterval=null,i.init()};return u.prototype={init:function(){var e=this;return e.renderHtml(),e.bindEvents(),e.queueFileOperations(),e.bindFilePreview(),e.disableUpload(r("Processing")),e.runQueue(),e},destroy:function(){var e=this;e.stopQueue(),e.stopUpload(),e.AU._removeFile(e.fileId),e.dom.container.parentNode.removeChild(e.dom.container),e.file=null,e.AU=null,e.xhr=null,e.exifData=null,e.dom=null,e.config=null},queueFileOperations:function(){t.log("queueFileOperations");var n=this;if(typeof o!="undefined"&&e.IMAGE_SCALE_ON&&n.AU.triggerEvent("beforeImageResize",[n])!==!1){var u=new o(n.file,n.config.resizeImage);u.done(function(e){n.AU.triggerEvent("imageResize",[n,e]),e&&(n.file=e,n.setSize(e.size)),n.setMessage("").setProgress(0)},n).progress(function(e){n.workProgress(r("Resizing"),e)},n),n._preUploadFun.push(u)}if(typeof i!="undefined"&&n.config.md5Calculate&&e.MD5_ON){n.AU.triggerEvent("md5Start",[n]);var a=new i(n.file);a.done(function(e){t.log("md5 calculated",e),n.md5=e,n.AU.triggerEvent("md5Done",[n,e]),n.setMessage("").setProgress(0)},n).progress(function(e){n.workProgress(r("Calculating md5"),e)},n),n._preUploadFun.push(a)}if(typeof s!="undefined"&&n.config.exifRead&&e.EXIF_ON){var f=new s(n.file);f.done(function(e){t.log("exif calculated",e),n.exifData=e,n.AU.triggerEvent("exifDone",[n,e]),n.setMessage("").setProgress(0),n.imgCls=n.fixOrientation(),n.dom.previewImage.className+=" "+n.imgCls},n).progress(function(e){n.workProgress(r("Reading exif"),e)},n),n._preUploadFun.push(f)}return n},stopQueue:function(){this.currentFun&&(this.currentFun.stop(),this.currentFun=null),this.enableUpload(r("Ready for upload")),this._preUploadFun=[]},runQueue:function(){if(this._preUploadFun.length>0){var e=this._preUploadFun.shift();e.always(this.runQueue,this),this.currentFun=e,e.start()}else this.enableUpload(r("Ready for upload"));return this},renderHtml:function(){var e=this,n=e.config.fileTemplate?e.config.fileTemplate:['<a class="ax-prev-container">','<img style="cursor: pointer;" class="ax-preview" src="" alt="">',"</a>",'<div class="ax-details">','<div class="ax-file-name"></div>','<div class="ax-file-size"></div>',"</div>",'<div class="ax-progress-data">','<div class="ax-progress">','<div class="loader ax-progress-bar"></div>','<div class="ax-progress-info"></div>',"</div>",'<div class="ax-progress-stat"></div>',"</div>",'<div class="ax-toolbar">','<a class="ax-upload ax-button">','<span class="ax-upload-icon ax-icon"></span>','<span class="ax-btn-text"></span>',"</a>",'<a class="ax-remove ax-button">','<span class="ax-clear-icon ax-icon"></span>','<span class="ax-btn-text"></span>',"</a>",'<a class="ax-delete ax-button ax-disabled">','<span class="ax-delete-icon ax-icon"></span>','<span class="ax-btn-text"></span>',"</a>",'<a class="ax-info ax-button">','<span class="ax-info-icon ax-icon"></span>','<span class="ax-btn-text"></span>',"</a>","</div>"].join(""),i=e.AU.triggerEvent("beforeRenderFile",[e,n]);i&&(n=i),e.dom.container=document.createElement("div");var s=e.dom.container;return s.innerHTML=n,s.classList.add("ax-file-wrapper"),e.dom.nameContainer=t.getEl(s,".ax-file-name"),e.dom.sizeContainer=t.getEl(s,".ax-file-size"),e.dom.uploadButton=t.getEl(s,".ax-upload"),e.dom.uploadButtonText=t.getEl(e.dom.uploadButton,".ax-btn-text"),e.dom.removeButton=t.getEl(s,".ax-remove"),e.dom.removeButtonText=t.getEl(e.dom.removeButton,".ax-btn-text"),e.dom.deleteButton=t.getEl(s,".ax-delete"),e.dom.deleteButtonText=t.getEl(e.dom.deleteButton,".ax-btn-text"),e.dom.infoButton=t.getEl(s,".ax-info"),e.dom.infoButtonText=t.getEl(e.dom.infoButton,".ax-btn-text"),e.dom.previewImage=t.getEl(s,".ax-preview"),e.dom.previewContainer=t.getEl(s,".ax-prev-container"),e.dom.progressBar=t.getEl(s,".ax-progress-bar"),e.dom.progressInfo=t.getEl(s,".ax-progress-info"),e.dom.progressStat=t.getEl(s,".ax-progress-stat"),e.setName(e.name).setSize(e.size).setUploadButton().setDeleteButton(!1).setRemoveButton(r("Remove file from queue")).setInfoButton(),e.AU.dom.fileList.appendChild(e.dom.container),e.AU.triggerEvent("afterRenderFile",[e,e.dom]),e},setName:function(e){return this.name=e,this.dom.container.setAttribute("title",e),this.dom.nameContainer&&(this.dom.nameContainer.innerHTML=e,this.dom.nameContainer.setAttribute("title",e)),this},setSize:function(e){return this.size=e,this.dom.sizeContainer&&(this.dom.sizeContainer.innerHTML=t.formatSize(e),this.dom.sizeContainer.setAttribute("title",this.dom.sizeContainer.innerHTML)),this},setUploadButton:function(){return this.dom.uploadButton&&!this.config.hideUploadButton&&(this.status==e.AX_READY||this.status==e.AX_ERROR?(this.dom.uploadButton.classList.remove("ax-abort"),this.dom.uploadButton.setAttribute("title",r("Start upload")),this.dom.uploadButtonText&&(this.dom.uploadButtonText.innerHTML=r("Upload"))):(this.dom.uploadButton.classList.add("ax-abort"),this.dom.uploadButton.setAttribute("title",r("Abort upload")),this.dom.uploadButtonText&&(this.dom.uploadButtonText.innerHTML=r("Abort")))),this},setRemoveButton:function(e){return this.dom.removeButton&&(this.dom.removeButton.setAttribute("title",e),this.dom.removeButtonText&&(this.dom.removeButtonText.innerHTML=r("Remove"))),this},setDeleteButton:function(e){return this.dom.deleteButton&&(e?(this.dom.deleteButton.setAttribute("title",r("Delete file from server")),this.dom.deleteButton.classList.remove("ax-disabled"),this.dom.deleteButtonText&&(this.dom.deleteButtonText.innerHTML=r("Delete"))):(this.dom.deleteButton.setAttribute("title",r("File still to be uploaded")),this.dom.deleteButton.classList.add("ax-disabled"),this.dom.deleteButtonText&&(this.dom.deleteButtonText.innerHTML=r("Delete")))),this},setInfoButton:function(){return this.dom.infoButton&&(this.dom.infoButton.setAttribute("title",r("Show file exif info")),this.dom.infoButtonText&&(this.dom.infoButtonText.innerHTML=r("Info"))),this},setPreviewImage:function(e,n){var i=this;return i.dom.previewImage&&(e?(i.dom.previewContainer&&(i.dom.previewContainer.style.background="none"),i.dom.previewImage.src=n,i.dom.previewImage.style.cursor="pointer",i.dom.previewImage.setAttribute("alt",r("Preview")),i.dom.previewImage.addEventListener("click",function(){t.lightBoxPreview(this,i.name,t.formatSize(i.size),i.imgCls)})):(i.dom.previewContainer&&(i.dom.previewContainer.classList.add("ax-no-preview"),i.dom.previewContainer.innerHTML='<span class="ax-extension">'+i.ext+"</span>"),i.dom.previewImage.style.display="none")),i},disableUpload:function(e){var t=this;return t.disabled=!0,t.dom.container.classList.add("ax-disabled"),t.setMessage(e),t},enableUpload:function(e){var t=this;return t.disabled=!1,t.dom.container.classList.remove("ax-disabled"),t.setMessage(e),t.setProgress(0),t},setProgress:function(e){return this.dom.progressBar&&(this.dom.progressBar.style.width=e+"%"),this},workProgress:function(e,t){var n=this;return n.setProgress(t),n.setMessage(e+" "+t+"%"),n.AU.triggerEvent("progressFile",[this,t]),n},setMessage:function(e){var t=this;return t.dom.progressInfo&&(t.dom.progressInfo.innerHTML=e,t.dom.progressInfo.setAttribute("title",e)),t},setInfo:function(e){return this.info=e,this},setExtraInfo:function(e){return this.extraInfo=e,this},getInfo:function(){return this.info},setTempName:function(e){return this.tempFileName=e,this},setStatus:function(t){var n=this;n.status=parseInt(t),n.setUploadButton();switch(n.status){case e.AX_UPLOADING:n.workProgress("",0);break;case e.AX_READY:n.workProgress(r("Ready for upload"),0),n.setDeleteButton(!1);break;case e.AX_ERROR:break;case e.AX_DONE:n.setMessage(r("File Uploaded")),n.setDeleteButton(!0)}return n},bindEvents:function(){var t=this;return t.dom.uploadButton&&t.dom.uploadButton.addEventListener("click",function(){t.config.enable&&!t.disabled&&(t.status!=e.AX_UPLOADING?t.AU.enqueueFile(t.fileId):t.stopUpload())}),t.dom.removeButton&&t.dom.removeButton.addEventListener("click",function(){t.config.enable&&!t.disabled?t.destroy():t.stopQueue()}),t.config.editFilename&&(t.dom.nameContainer.addEventListener("dblclick",function(e){if(t.config.enable&&!t.disabled){e.stopPropagation();var n=t.name.replace("."+t.ext,"");this.innerHTML='<input type="text" value="'+n+'" />.'+t.ext}}),t.dom.nameContainer.addEventListener("blur focusout",function(e){e.stopPropagation();var n=this.firstChild;if(n){var r=n.value.replace(/[|&;$%@"<>()+,]/g,""),i=r+"."+t.ext;t.setName(i)}})),t.dom.deleteButton&&t.config.allowDelete&&t.dom.deleteButton.addEventListener("click",function(){!t.disabled&&t.status===e.AX_DONE&&t.askUser(r("Delete uploaded file?")).yes(function(){t.deleteFile()}).no(function(){t._onError("abort",r("User stop"))})}),this.dom.infoButton&&this.dom.infoButton.addEventListener("click",function(){var e="";for(var n in t.exifData)t.exifData.hasOwnProperty(n)&&(typeof t.exifData[n]=="object"?e+=n+" : ["+t.exifData[n].length+" values]"+"\n":e+=n+" : "+t.exifData[n]+"\n");alert(e)}),this},deleteFile:function(){var n=this;if(n.config.allowDelete){var r=n.getParams();r.append("ax-delete-file",1),t.ajaxPost(n.config.url,r,null),n.setStatus(e.AX_READY)}},bindFilePreview:function(){var t=this,n=t.AU.triggerEvent("beforePreview",[this]),r=t.config.previews&&t.file.type.match(/image.*/)&&(t.ext==="jpeg"||t.ext==="jpg"||t.ext==="gif"||t.ext==="png"),i=window.URL||window.webkitURL;if(i&&i.createObjectURL&&r&&t.config.previewFileSize>=t.size&&n!==!1){var s=new Image;s.onload=function(){t.setPreviewImage(!0,this.src),t.AU.triggerEvent("preview",[this]),t.setStatus(e.AX_READY),i.revokeObjectURL(t.file),s=null},s.onerror=function(){t.setStatus(e.AX_READY)},s.src=i.createObjectURL(this.file)}else t.setPreviewImage(!1,null),t.setStatus(e.AX_READY);return this},fixOrientation:function(){var e=this;if(e.dom.previewImage&&this.exifData&&this.exifData.Orientation){var n=e.dom.previewImage.width,r=e.dom.previewImage.height,i=this.exifData.Orientation;t.log("fixOrientation:",i);switch(i){case 5:case 6:case 7:case 8:break;default:}switch(i){case 2:return"ax-flip-x";case 3:return"ax-rotate-180";case 4:return"ax-flip-y";case 5:return"ax-flip-y-90";case 6:return"ax-rotate-90";case 7:return"ax-flip-x-90";case 8:return"ax-rotate-inv-90"}}else t.log("fixOrientation: no exif")},askUser:function(e){var i=this,s=new n(i),o=['<div class="ax-ask-inner">','<div class="ax-ask-quest">'+e+"</div> ",'<a title="'+r("Yes")+'" class="ax-button ax-reply-yes"><span class="ax-icon"></span> <span class="ax-btn-text">'+r("Yes")+"</span></a>",'<a title="'+r("No")+'" class="ax-button ax-reply-no"><span class="ax-icon"></span> <span class="ax-btn-text">'+r("No")+"</span></a>","</div>"],u=document.createElement("div");u.className="ax-ask-div",u.innerHTML=o.join(""),this.dom.container.appendChild(u);var a=t.getEl(u,".ax-reply-yes"),f=t.getEl(u,".ax-reply-no");return a&&a.addEventListener("click",function(e){s.run("yes")}),f&&f.addEventListener("click",function(e){s.run("no")}),s.always(function(){u.parentNode.removeChild(u),u=null}),s},checkFileExists:function(){var e=new n(this),r=this;if(this.config.checkFileExists){var i=this.getParams();i.append("ax-check-file",1),t.ajaxPost(this.config.url,i,function(t){e.run(t.info=="yes"?"yes":"no")})}else setTimeout(function(){e.run("no")},10);return e},startUpload:function(){t.log("startUpload:::called");var n=this;return n.disabled?!1:(n.AU.triggerEvent("beforeUploadFile",[n,this.name])!==!1?(n.status=e.AX_CHECK,n.checkFileExists().yes(function(){n.askUser(r("File exits on server. Override?")).yes(function(){n._upload()}).no(function(){n._onError("abort",r("User stop"))})}).no(function(){n._upload()})):n._onError("beforeUploadFile",r("beforeUploadFile::File validation failed")),n)},getParams:function(){var e=this.AU.getBaseParams(this);return e.append("ax-file-size",this.size),e.append("ax-file-name",this.name),e.append("ax-temp-name",this.tempFileName),e},stopUpload:function(){return this.xhr!==null&&(this.xhr.abort(),this.xhr=null),this.speedInterval&&clearInterval(this.speedInterval),this},_upload:function(){t.log("_upload:::Uploading chunk");var n=this,i=n.config,s=n.file,o=n.currentByte,u=n.name,a=n.size,f=i.chunkSize,l=f+o,c=a-l<=0,h=s;n.xhr=new XMLHttpRequest,o===0&&this._onStart(),n.requestStartTime=new Date,n.abortTimeout=null,f==0?(h=s,c=!0):h=t.sliceFile(s,o,l),h===null&&(h=s,c=!0),n.xhr.upload.addEventListener("abort",function(e){n._onError("aborted",r("Upload aborted"))},!1),n.xhr.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round((e.loaded+o)*100/a);n.workProgress(r("Uploading"),t),n.loading_bytes=e.loaded+o,n.AU.progress(n,o)}},!1),n.xhr.upload.addEventListener("error",function(e){n._onError(this.responseText)},!1),n.xhr.onreadystatechange=function(){if(this.readyState==4&&this.status==200){n.AU.triggerEvent("chunkUpload",[s,u,h,n.xhr]);try{var r=JSON.parse(this.responseText);o==0&&n.setTempName(r.temp_name),n.requestDuration=new Date-n.requestStartTime,t.log("Request Duration (ms): ",n.requestDuration),n.abortTimeout!==null&&(clearTimeout(n.abortTimeout),n.abortTimeout=null);if(parseInt(r.status)===e.AX_ERROR)throw r.info;c?n._onFinishUpload(r):(n.currentByte=l,n._upload())}catch(i){n._onError("server_error",i.toString())}}else this.status==404&&n._onError("server_error","_upload::URL not found 404. Be sure to point to the correct upload.php.")},n.requestDuration>0&&!c&&(n.abortTimeout=setTimeout(function(){n.xhr.abort(),n._upload()},n.requestDuration*10));var p=this.getParams();p.append("ax_file_input",h),p.append("ax-start-byte",n.currentByte),p.append("ax-file-md5",n.md5),n.xhr.open("POST",i.url,i.async),n.xhr.send(p)},_onStart:function(){var n=this;n.workProgress(r("Upload started"),0),n.loading_bytes=0,n.AU.progress(this,0),n.AU.triggerEvent("startFile",[this]),n.setStatus(e.AX_UPLOADING),n.config.bandwidthUpdateInterval&&n.dom.progressStat&&(n.speedInterval=setInterval(function(){var e=(n.loading_bytes-n.temp_bytes)*(1e3/n.config.bandwidthUpdateInterval);n.dom.progressStat.innerHTML=t.formatSize(e)+"/s",n.temp_bytes=n.loading_bytes},n.config.bandwidthUpdateInterval))},_onError:function(t,n){var r=this;r.setMessage(n).setInfo(t),t=="aborted"?r.setStatus(e.AX_READY):t=="error"&&(r.setStatus(e.AX_ERROR),r.config.removeOnError&&r.destroy()),r._onComplete()},_onFinishUpload:function(e){var t=this;t.setName(e.name).setStatus(e.status).setInfo(e.info).setExtraInfo(e.more).setMessage(r("File uploaded")),t.checkSum=e.checkSum,t._onComplete(),t.config.removeOnSuccess&&t.destroy()},_onComplete:function(){var e=this;return e.currentByte=0,e.setProgress(0),this.speedInterval&&(t.log("stopping speedInterval"),clearInterval(e.speedInterval),e.speedInterval=null),e.AU.fileCompleted(e.fileId),this}},u}),n("RealUploader",["FileObject","Constants","Utils","i18n"],function(e,t,n,r){"use strict";var i=function(e,i){this.fileList={},this.fileIndex=0,this.uploadQueue=[],this.globalStatus=t.AX_IDLE,this.dom={},this.total_bytes=0,this.checkInterval=!1,e instanceof HTMLElement?this.dom.container=e:typeof e=="string"&&(this.dom.container=n.getEl(e));if(!this.dom.container){console.error(e+r(" not found on the DOM"));return}if(this.dom.container.classList.contains("ax-uploader")){console.warn(r("Real Uploader already bind to this element"));return}this.config={_data:{accept:null,allowedExtensions:[],allowDelete:!1,autoStart:!1,async:!0,bandwidthUpdateInterval:500,checkFileExists:!1,chunkSize:1048576,data:{},dropClass:"ax-drop",dropArea:"self",enable:!0,editFilename:!1,exifRead:!1,fileTemplate:null,hideUploadButton:!1,language:"auto",mainTemplate:null,maxFiles:9999,maxConnections:3,maxFileSize:10485760,minFileSize:0,md5Calculate:!1,md5Check:!0,overrideFile:!1,thumbHeight:0,thumbWidth:0,thumbPostfix:"_thumb",thumbPath:"",thumbFormat:"",url:"upload.php",uploadDir:!1,removeOnSuccess:!1,removeOnError:!1,remotePath:"",resizeImage:{maxWidth:0,maxHeight:0,outputQuality:1,scaleMethod:3,outputFormat:null,allowOverResize:!1,keepExif:!1,keepAspectRatio:!0,unsharpAmount:0,unsharpThreshold:0,alpha:!0},previews:!0,previewFileSize:10485760,listeners:null,validateFile:null}},this.events={init:[],start:[],startFile:[],finish:[],finishFile:[],error:[],errorFile:[],beforeUpload:[],beforeUploadFile:[],progress:[],progressFile:[],beforePreview:[],preview:[],select:[],chunkUpload:[],exifDone:[],md5Start:[],md5Done:[],beforeImageResize:[],imageResize:[],dragEnter:[],dragLeave:[],dragOver:[],drop:[],afterRenderFile:[],beforeRenderFile:[]},this.preCheckSettings(i),this.slots=this.config.maxConnections,new r(this.config.language),this.checkUploadSupport()&&(this.renderHtml(),this._bindEvents(),this.triggerEvent("init",[]))};return i.prototype={preCheckSettings:function(e){var t=this;return Object.defineProperty(t.config,"accept",{get:function(){return this._data.accept?this._data.accept:""},set:function(e){this._data.accept=e,t._setAcceptAttribute()}}),Object.defineProperty(t.config,"allowedExtensions",{get:function(){return this._data.allowedExtensions},set:function(e){this._data.allowedExtensions=e.map(function(e){return e.toLowerCase()}),t._setAcceptAttribute()}}),Object.defineProperty(t.config,"language",{get:function(){if(this._data.language=="auto"){var e=window.navigator.userLanguage||window.navigator.language;return e.replace("-","_")}return this._data.language},set:function(e){this._data.language=e}}),Object.defineProperty(t.config,"maxFileSize",{get:function(){return this._data.maxFileSize},set:function(e){this._data.maxFileSize=n.parseSize(e)}}),Object.defineProperty(t.config,"minFileSize",{get:function(){return this._data.minFileSize},set:function(e){this._data.minFileSize=n.parseSize(e)}}),Object.defineProperty(t.config,"listeners",{get:function(){return this._data.listeners},set:function(e){if(typeof e=="object"){for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];t.on(n,r.fn||r,r.scope||t)}this._data.listeners=e}}}),Object.defineProperty(t.config,"enable",{get:function(){return this._data.enable},set:function(e){this._data.enable=!!e,this._data.enable?t.dom.container.classList.remove("ax-disabled"):t.dom.container.classList.add("ax-disabled")}}),n.extend(this.config,this.config._data,!1),n.extend(this.config,e,!1),n.log("Final config",this.config.remotePath),this.config},checkUploadSupport:function(){var e=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&/Version\/5\./.test(navigator.userAgent)&&/Win/.test(navigator.platform);if(e||window.FormData===undefined)return console.error(r("This browser does not support Ajax Upload")),!1;var t=navigator.userAgent.indexOf(" OS 7_")!==-1;return t&&(this.config.maxFiles=1),!0},renderHtml:function(){var e=this.config.mainTemplate?this.config.mainTemplate:'<div class="ax-main-container"><h5 class="ax-main-title">Select Files or Drag&amp;Drop Files</h5><div class="ax-main-buttons"><a title="Add files" class="ax-browse-c ax-button"><span class="ax-browse-icon ax-icon"></span> <span class="ax-browse-text ax-text">Add files</span><input type="file" class="ax-browse" multiple /></a><a title="Upload all files" class="ax-upload-all ax-button"><span class="ax-upload-icon ax-icon"></span> <span class="ax-upload-text ax-text">Start upload</span></a><a title="Remove all" class="ax-clear ax-button"><span class="ax-clear-icon ax-icon"></span> <span class="ax-clear-text ax-text">Remove all</span></a></div><div class="ax-file-list"></div></div>';this.dom.container.classList.add("ax-uploader"),this.dom.container.innerHTML=e;var t=this.dom.container;this.dom.title=n.getEl(t,".ax-main-title"),this.dom.browseButton=n.getEl(t,".ax-browse-c"),this.dom.browseInput=n.getEl(t,".ax-browse"),this.dom.uploadButton=n.getEl(t,".ax-upload-all"),this.dom.removeButton=n.getEl(t,".ax-clear"),this.dom.fileList=n.getEl(t,".ax-file-list"),this.dom.title&&(this.dom.title.innerHTML=r("Select Files or Drag&Drop Files")),this.dom.browseButton&&(this.dom.browseButton.setAttribute("title",r("Add files")),this.dom.browseButtonText=n.getEl(this.dom.browseButton,".ax-text"),this.dom.browseButtonText&&(this.dom.browseButtonText.innerHTML=r("Add files"))),this.dom.uploadButton&&(this.dom.uploadButton.setAttribute("title",r("Upload all files")),this.dom.uploadButtonText=n.getEl(this.dom.uploadButton,".ax-text"),this.dom.uploadButtonText&&(this.dom.uploadButtonText.innerHTML=r("Start upload"))),this.dom.removeButton&&(this.dom.removeButton.setAttribute("title",r("Remove all")),this.dom.removeButtonText=n.getEl(this.dom.removeButton,".ax-text"),this.dom.removeButtonText&&(this.dom.removeButtonText.innerHTML=r("Remove all"))),this.dom.browseInput&&(this.config.maxFiles!=1&&this.dom.browseInput.setAttribute("multiple","multiple"),this._setAcceptAttribute(),this.config.uploadDir&&(this.dom.browseInput.setAttribute("directory","directory"),this.dom.browseInput.setAttribute("webkitdirectory","webkitdirectory"),this.dom.browseInput.setAttribute("mozdirectory","mozdirectory")))},_setAcceptAttribute:function(){var e=this.config.accept?this.config.accept+",":"";this.config.allowedExtensions.length>0&&(e+="."+this.config.allowedExtensions.join(",.")),this.dom.browseInput&&e&&this.dom.browseInput.setAttribute("accept",e)},_bindEvents:function(){var e=this;this.dom.browseInput&&this.dom.browseInput.addEventListener("change",function(){e.config.enable&&(e.addFiles(this.files),this.value="")}),this.dom.uploadButton&&this.dom.uploadButton.addEventListener("click",function(){return e.config.enable&&e.enqueueAll(),!1}),this.dom.removeButton&&this.dom.removeButton.addEventListener("click",function(){return e.config.enable&&e.clearQueue(),!1});var t=null;e.config.dropArea instanceof HTMLElement?t=e.config.dropArea:e.config.dropArea==="self"?t=this.dom.container:typeof t=="string"?t=n.getEl(t):typeof e.config.dropArea=="function"&&(t=e.config.dropArea.call(this)),this.setDropArea(t),this.enable(this.config.enable)},setDropArea:function(e){if(e&&e instanceof HTMLElement){var t=this;t.dom.dropMask=n.doEl("div"),t.dom.dropMask.classList.add("ax-mask"),t.dom.dropMask.innerHTML='<div class="ax-mask-icon"></div>',t.dom.container.appendChild(t.dom.dropMask);var r=!1,i=!1,s=this.config,o=function(e){e.stopPropagation(),e.preventDefault()},u=function(n){o(n),s.enable&&!r&&(t.triggerEvent("dragEnter",[n,e]),r=!0,i=!1,t.dom.dropMask.style.display="table-cell")},a=function(n){o(n),s.enable&&!i&&(s.dropClass&&e.classList.remove(s.dropClass),t.triggerEvent("dragLeave",[n,e]),r=!1,i=!0,t.dom.dropMask.style.display="none")},f=function(n){o(n),s.enable&&(s.dropClass&&e.classList.add(s.dropClass),t.triggerEvent("dragOver",[n,e]))},l=function(n){o(n),s.enable&&(t.addFiles(n.dataTransfer.files),s.dropClass&&e.classList.remove(s.dropClass),t.triggerEvent("drop",[n,this]),t.dom.dropMask.style.display="none",r=!1)};e.addEventListener("dragenter",u),t.dom.dropMask.addEventListener("dragleave",a),t.dom.dropMask.addEventListener("dragover",f),t.dom.dropMask.addEventListener("drop",l)}},fileCompleted:function(e,n){var r=!0,i=this.fileList[e];for(var s in this.fileList)if(this.fileList.hasOwnProperty(s)){var o=this.fileList[s];o.status!==t.AX_DONE&&o.status!==t.AX_ERROR&&(r=!1)}switch(i.status){case t.AX_DONE:this.triggerEvent("finishFile",[i,n]);break;case t.AX_ERROR:this.triggerEvent("errorFile",[i,i.getInfo(),i.name])}r&&this.finish(),this.slots++},finish:function(){this.globalStatus=t.AX_DONE;var e=[];for(var n in this.fileList)this.fileList.hasOwnProperty(n)&&e.push(this.fileList[n].name);this.triggerEvent("finish",[e,this.fileList])},generateFileId:function(){return this.fileIndex++,"file_"+this.fileIndex},addFiles:function(t){var n=[];for(var r=0;r<t.length;r++){var i=t[r];i.extension=i.name.split(".").pop().toLowerCase();var s=this.checkFile(i.name,i.size,i.extension);if(s.length==0){var o=this.generateFileId();this.fileList[o]=new e(i,o,this),n.push(this.fileList[o])}else this.triggerEvent("errorFile",[s,i.name])}this.triggerEvent("select",[n]),this.config.autoStart&&this.enqueueAll()},checkFile:function(e,t,n){var i=this.config.allowedExtensions,s=Object.keys(this.fileList).length,o=[],u=!1,a=s<this.config.maxFiles,f=i.indexOf(n)>=0||i.length==0,l=t<=this.config.maxFileSize;return typeof this.config.validateFile=="function"&&(u=this.config.validateFile.call(this,e,n,t)),a||o.push({message:r("Maximum files number reached"),error:"MAX_FILES",param:s}),f||o.push({message:r("Extension not allowed"),error:"ALLOW_EXTENSION",param:n}),l||o.push({message:r("File size now allowed"),error:"FILE_SIZE",param:t}),u&&o.push({message:u,error:"USER_ERROR",param:""}),o},enqueueFile:function(e){this.uploadQueue.push(this.fileList[e]),this.processQueue()},enqueueAll:function(){var e=this.getPendingFiles();if(e.length==0)this.triggerEvent("error",["NO_FILES",t.AX_NO_FILES]);else if(this.triggerEvent("beforeUpload",[this.fileList])!==!1){this.triggerEvent("start",[e]);for(var n=0,r=e.length;n<r;n++)this.uploadQueue.push(e[n]);this.processQueue()}else this.triggerEvent("error",["beforeUpload"])},startUpload:function(){this.enqueueAll()},processQueue:function(){var e=this;e.checkInterval||(n.log("Process queue"),e.checkInterval=setInterval(function(){n.log("Start interval");if(e.uploadQueue.length==0)clearInterval(e.checkInterval),e.checkInterval=null,n.log("No more files. Stop timer.");else{e.globalStatus=t.AX_UPLOADING;for(var r=0;r<e.uploadQueue.length;r++){var i=e.uploadQueue[r];if(e.slots>0&&i.status==t.AX_READY&&!i.disabled){var s=e.uploadQueue.shift();s.startUpload(),e.slots--}else n.log("processQueue:::",i.status,!i.disabled,e.slots)}}},500))},getPendingFiles:function(){var e=[];for(var n in this.fileList)if(this.fileList.hasOwnProperty(n)){var r=this.fileList[n];(r.status==t.AX_READY||r.status==t.AX_IDLE||r.status==t.AX_CHECK)&&e.push(r)}return e},isUploading:function(){return this.globalStatus==t.AX_UPLOADING},isIdle:function(){return this.globalStatus==t.AX_IDLE},hasFiles:function(){return Object.keys(this.fileList).length!=0},progress:function(e,t){this.total_bytes=+t,this.triggerEvent("progress",[this.total_bytes])},clearQueue:function(){for(var e in this.fileList)this.fileList.hasOwnProperty(e)&&this.fileList[e].destroy()},getBaseParams:function(e){n.log("getBaseParams:::called");var t=this.config,r=new FormData,i=t.remotePath;typeof i=="function"&&(i=i.call(this,e)),r.append("ax-file-path",i),r.append("ax-allow-ext",t.allowedExtensions.join("|")),r.append("ax-max-file-size",t.maxFileSize),r.append("ax-thumbPostfix",t.thumbPostfix),r.append("ax-thumbPath",t.thumbPath),r.append("ax-thumbFormat",t.thumbFormat),r.append("ax-thumbHeight",t.thumbHeight),r.append("ax-thumbWidth",t.thumbWidth),(t.checkFileExists||t.overrideFile)&&r.append("ax-override",1),t.md5Check&&t.md5Calculate&&r.append("ax-md5checksum",1);var s=this.getUserData(t.data,e);for(var o in s)s.hasOwnProperty(o)&&r.append(o,s[o]);return r},getUserData:function(e,t){typeof e=="function"&&(e=e.call(this,t));if(typeof e=="string"){var n=e.split("&");e={};for(var r=0;r<n.length;r++){var i=n[r].split("=");i[0]!==undefined&&i[1]!==undefined&&(e[i[0]]=i[1])}}return typeof e!="object"&&(e={}),e},_removeFile:function(e){delete this.fileList[e]},stopUpload:function(){for(var e in this.fileList)if(this.fileList.hasOwnProperty(e)){var n=this.fileList[e];n.status==t.AX_UPLOADING&&n.stopUpload()}return this},enable:function(e){return this.config.enable=e,this},on:function(e,t,n){var r=e.split("."),i=r[0],s=r[1]!==undefined?r[1]:"";return this.events[i]&&(n||(n=this),this.events[i].push([t,n,s])),this},off:function(e){var t=eventSpace.split("."),e=t[0],n=t[1]!==undefined?t[1]:"";if(this.events[e]){var r=[];for(var i=0;i<this.events[e].length;i++)n!==this.events[e][i][2]&&r.push(this.events[e][i]);this.events[e]=r}},triggerEvent:function(e,t){var r=null;if(this.events[e]){n.log("triggerEvent",e,t);var i=this.events[e];for(var s=0,o=i.length;s<o;s++){var u=i[s];r=u[0].apply(u[1],t)}}return r},debugMode:function(e){t.ENV=e}},i}),t("RealUploader")});